# Технические характеристики торгового алгоритма

## Режим торговли и рынок

- Режим: **Cross Margin** (Binance).
- Инструмент: `BTCUSDT` (зашито в `BinanceMarginExecution`).
- Тип стратегии: **Directional Hedge Scalping**.

## Состояния конечного автомата

- `IDLE` → ожидание.
- `ARMED` → готов к запуску цикла.
- `ENTERING` → вход и открытие хеджа.
- `DETECTING` → поиск победителя.
- `CUTTING` → закрытие проигравшей ноги.
- `RIDING` → сопровождение победителя.
- `EXITING` → выход победителя.
- `COOLDOWN` → пауза перед следующим циклом.
- `ERROR` → ошибка и остановка цикла.

## Источники данных

- Основной источник: **WebSocket** тики (`ws_market`).
- Резерв: **HTTP fallback** (`http_fallback`) при проблемах WS.
- Для фильтра входа данные считаются устаревшими при возрасте > 500 мс.
- Во время сопровождения победителя выход выполняется при устаревании > 1500 мс.

## Ордерная логика

- Типы ордеров:
  - `market` — немедленное исполнение.
  - `aggressive_limit` — лимитный ордер IOC с ценой на 1 тик за bid/ask.
- Хедж-вход: одновременно **BUY** и **SELL**.
- Шорт-часть использует `AUTO_BORROW`, закрытие — `AUTO_REPAY`.

## Параметры стратегии (ключевые)

- `usd_notional` — номинал входа в USD.
- `max_spread_bps` — лимит спреда.
- `min_tick_rate` — минимальная скорость тиков.
- `impulse_min_bps` — минимальный импульс.
- `winner_threshold_bps` — порог определения победителя.
- `target_net_bps` — целевая прибыль победителя после комиссий.
- `emergency_stop_bps` — порог экстренного стопа.
- `detect_timeout_ms` — таймаут ожидания победителя.
- `cooldown_s` — длительность cooldown между циклами.

## Контроль риска

- Запрет на вход при открытой экспозиции или незакрытых ордерах.
- Проверка минимального лота/ноционала по фильтрам биржи.
- Аварийное выравнивание позиции при любых критических ошибках.

## Производительность и надежность

- `TradeEngine` работает в отдельном потоке для UI.
- Watchdog проверяет “фриз” GUI по heartbeat каждые 2 секунды.
- Логи выводятся в UI и пишутся в файл (rotating).

# Структура проекта

Документ описывает актуальную структуру репозитория Directional Hedge Scalper v0.3.5,
уровни вложенности и связи между подсистемами.

## Верхний уровень

- `README.md` — краткое описание, установка, запуск и заметки по циклам.
- `requirements.txt` — зависимости Python.
- `RUN_GUI.ps1` — сценарий «запуска в один клик» для Windows.
- `.env.example` — пример переменных окружения (API ключи и режимы).
- `.gitignore`, `.gitkeep` — настройки Git и поддержка пустых директорий.
- `docs/` — документация по архитектуре, алгоритмам и характеристикам.
- `src/` — исходный код приложения.
- `tests/` — минимальные проверки алгоритма и сервисов.

## Директория `src/`

### `src/app/`

- Точка входа GUI и инициализация приложения.
- Связывает UI, `TradeEngine` и фоновый поток данных.

### `src/core/`

- Конфигурация и модели данных (параметры стратегии, снимки рынка, телеметрия цикла).
- Логирование, форматирование и ротация логов.
- Конечный автомат состояний (`BotStateMachine`).
- `TradeEngine` — оркестратор жизненного цикла, автоцикла и соединений.

### `src/engine/`

- Реализация основного торгового цикла (hedge вход → определение победителя → cut → ride → exit).
- Аварийные сценарии (controlled/emergency flatten).
- Тестовый режим и эмуляции.

### `src/exchange/`

- Исполнение ордеров на Binance Cross Margin.
- Методы выставления, отмены и ожидания заполнения, repay.

### `src/services/`

- Источники рыночных данных:
  - WebSocket (`ws_market.py`) — bookTicker + depth.
  - HTTP fallback (`http_fallback.py`) — bookTicker REST.
- Агрегация и переключение источников (`market_data.py`).
- REST клиент Binance (`binance_rest.py`) и синхронизация времени (`time_sync.py`).
- Подсистема стакана (`orderbook.py`).

### `src/gui/`

- Пользовательский интерфейс (Qt/PySide6).
- Вкладки настроек, параметров стратегии, журналов, таблицы сделок и статуса.
- Общие UI-компоненты и вспомогательные виджеты.

## Директория `tests/`

- `test_tickrate_ws_alive.py` — проверка логики tick-rate при «живом» WS.
- `test_impulse_tickrate.py` — проверки импульса и тикрейта.
- `test_detect_window.py` — сценарии окна детекта.
- `test_margin_sideeffect.py` — контроль sideEffectType для маржинальных ордеров.

## Поток данных (высокий уровень)

1. GUI инициализирует `TradeEngine`, подключает параметры и режимы.
2. `MarketDataThread` получает WS данные и публикует тики.
3. `MarketDataService` агрегирует WS/HTTP тики и выбирает «effective tick».
4. `DirectionalCycle` применяет фильтры входа, управляет ордерами и состояниями.
5. `BinanceMarginExecution` исполняет ордера через REST.

## Ключевые точки интеграции

- **GUI → TradeEngine**: запуск/остановка, параметры стратегии, режимы данных.
- **TradeEngine → DirectionalCycle**: контроль цикла, обновление фильтров и логика автоцикла.
- **DirectionalCycle → Exchange**: размещение ордеров, отмены, ожидание fill, repay.
- **MarketDataService → DirectionalCycle**: снапшоты тиков, метрики, возраст данных.

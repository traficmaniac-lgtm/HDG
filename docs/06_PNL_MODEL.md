# PnL Model

## Unrealized PnL (est)
- Если позиция открыта: `(mid - buy_price) * qty`.
- Если позиция не открыта, но BUY `NEW`: используется цена BUY.
- Если `mid = None` → Unrealized не считается.

## Realized PnL
- `pnl_cycle` фиксируется при закрытии позиции (SELL FILLED):
  `(sell_price - buy_price) * qty`.
- Для TP/SL дополнительно логируется `pnl_bps` как:
  `(pnl_quote / (buy_price * qty)) * 10000`.

## Session PnL
- `pnl_session` — сумма `pnl_cycle` за GUI-сессию.

## Что считается сейчас
- Только простая разница цены BUY/SELL без комиссий и проскальзывания.
- Без учета процентов по займу, funding, или частичных исполнений.
- Для TP/SL фиксируется причина выхода (`TP`/`SL`) и логируется как `reason=...`.

## Что ЗАПРЕЩЕНО считать
- Комиссии, проскальзывание, проценты по займам.
- PnL на основе неисполненных/частично исполненных ордеров.
- Любые расчёты вне текущего цикла BUY → SELL.

## Ограничения
- PnL не корректируется на фактические комиссии биржи.
- Не ведётся учёт funding или borrow-interest.

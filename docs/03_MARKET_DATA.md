# Market Data

## WS vs HTTP fallback
- Основной источник: WS `bookTicker`.
- Резервный источник: HTTP `bookTicker`.

## Метрики возраста
- `ws_age_ms` — возраст последнего WS-апдейта.
- `http_age_ms` — возраст последнего HTTP-апдейта.
- `mid_age_ms` — возраст последней рассчитанной mid-цены.

## Правила валидности цены
Котировка считается валидной, если:
- **WS**: `ws_age_ms <= ws_fresh_ms` и есть `bid/ask`.
- **HTTP**: `http_age_ms <= http_fresh_ms` и есть `bid/ask`.
- Если нет валидных источников, источник = `NONE`.

## Когда mid считается None
- Нет валидной котировки (оба источника не свежие).
- Отсутствует `bid` или `ask` у выбранного источника.

## Причины HTTP fallback
- WS не подключён или потеря соединения.
- WS-данные устарели (`ws_age_ms > ws_fresh_ms`).
- WS-данные неполные (нет `bid/ask`).

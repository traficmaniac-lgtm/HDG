# 04_MARGIN_MODEL — Модель маржинальной торговли

## Режим торговли: CROSS MARGIN x3
- Основной режим: **Cross Margin**.
- Параметр `account_mode` задаётся как `CROSS_MARGIN`.
- `leverage_hint = 3` — целевой уровень плеча (индикативно, не принудительно).
- `margin_isolated = False` — изолированная маржа не используется.

## Что значит borrow fail
Borrow fail означает, что API-ключ **не имеет права** занимать средства в Cross Margin.
Типичные признаки:
- HTTP 401 или код `-1002` (недостаточные permissions),
- сообщения о запрете заимствования при попытке borrow.

## Когда borrow нужен, а когда нет
- **Borrow НЕ нужен**, если:
  - на балансе достаточно свободных средств (`free`) для сделки.
- **Borrow НУЖЕН**, если:
  - средств недостаточно, но разрешён `AUTO_BORROW_REPAY`.
- Управление borrow:
  - `allow_borrow = True` → используется `sideEffectType=AUTO_BORROW_REPAY`.
  - `allow_borrow = False` → заимствование отключено.

## Ограничения и риски
- Без borrow вход может быть заблокирован при нехватке свободных средств.
- При включённом borrow API должен иметь:
  - доступ к Margin Trading,
  - разрешение Spot & Margin,
  - отсутствие IP-ограничений,
  - активный доступ к Cross Margin Borrow.
- Ошибки borrow должны переводить торговлю в безопасное состояние и исключать новые входы.

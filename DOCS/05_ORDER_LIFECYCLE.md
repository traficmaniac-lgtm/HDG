# 05_ORDER_LIFECYCLE — Жизненный цикл ордера

## Полный жизненный цикл
**PLACE → ACK → PARTIAL → FILLED → CANCEL**

### Подробно
1. **PLACE**
   - Бот отправляет запрос на размещение ордера (BUY или SELL).
2. **ACK (NEW)**
   - Биржа подтверждает приём.
   - Ордер появляется в open orders.
3. **PARTIAL**
   - Возможна частичная сделка (на бирже статус может быть `PARTIALLY_FILLED`).
4. **FILLED**
   - Ордер полностью исполнен.
   - Для BUY → открывается позиция.
   - Для SELL → позиция закрывается, фиксируется PnL.
5. **CANCEL / REJECT / EXPIRED**
   - Ордер не исполнился.
   - Требуется обработка и возврат в безопасное состояние.

## Что считается успешным входом
- BUY ордер получил статус **FILLED**.
- Внутренняя позиция установлена с:
  - `buy_price`,
  - `qty`,
  - `opened_ts`.

## Что считается аварией
- Ошибка размещения (place order failed).
- Ордер не подтверждён (ACK отсутствует).
- Ордер завис (долго в NEW без прогресса, без данных).
- Любой статус `REJECTED`, `CANCELED`, `EXPIRED` без корректного восстановления состояния.
- Состояние `ERROR` в FSM.

## Ключевые правила
- **Нет новой заявки, пока есть активный ордер.**
- Все переходы должны быть согласованы с FSM (см. 07_STATE_MACHINE).
- Любой сбой в жизненном цикле должен приводить к безопасному выходу и логированию причины.

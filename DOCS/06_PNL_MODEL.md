# PnL Model

## Unrealized PnL (est)
- Если позиция открыта: `(mid - buy_price) * qty`.
- Если позиция не открыта, но BUY `NEW`: используется цена BUY и его `qty`.
- Если `mid = None` → unrealized не считается.

## Cycle PnL
- `pnl_cycle` фиксируется при полном закрытии позиции (SELL `FILLED`).
- Формула: `(sell_price - buy_price) * qty`.
- Для TP/SL дополнительно логируется `pnl_bps`:
  `(pnl_quote / (buy_price * qty)) * 10000`.

## Session PnL
- `pnl_session` — сумма `pnl_cycle` за всю GUI‑сессию.

## Частичные исполнения
- SELL partial снижает остаток позиции, но **не** закрывает цикл.
- При «partial‑close» завершении (слишком малый остаток) PnL может остаться неопределённым.

## Что считается сейчас
- Только разница цен BUY/SELL без комиссий, процентов по займам и проскальзывания.
- Нет учета funding/interest/fees.

## Что не учитывается намеренно
- Комиссии Binance и проскальзывание.
- PnL по неисполненным/частично исполненным заявкам (кроме итогового SELL `FILLED`).
